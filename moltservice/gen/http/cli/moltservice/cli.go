// Code generated by goa v3.14.1, DO NOT EDIT.
//
// moltservice HTTP client CLI support package
//
// Command:
// $ goa gen github.com/cockroachdb/molt/moltservice/design -o ./moltservice

package cli

import (
	"flag"
	"fmt"
	"net/http"
	"os"

	moltservicec "github.com/cockroachdb/molt/moltservice/gen/http/moltservice/client"
	goahttp "goa.design/goa/v3/http"
	goa "goa.design/goa/v3/pkg"
)

// UsageCommands returns the set of commands and sub-commands using the format
//
//	command (subcommand1|subcommand2|...)
func UsageCommands() string {
	return `moltservice create-fetch-task
`
}

// UsageExamples produces an example of a valid invocation of the CLI tool.
func UsageExamples() string {
	return os.Args[0] + ` moltservice create-fetch-task --body '{
      "bucket_name": "http://localhost:5000",
      "bucket_path": "fetch/export",
      "cleanup_intermediary_store": true,
      "compression": "none",
      "local_path": "/usr/Documents/fetch",
      "local_path_crdb_address": "http://localhost:5000",
      "local_path_listen_address": "http://localhost:5000",
      "log_file": "task.log",
      "mode": "DIRECT_COPY",
      "name": "rluu pg to cockroach",
      "num_batch_rows_export": 100000,
      "num_concurrent_tables": 4,
      "num_flush_bytes": 2000,
      "num_flush_rows": 200000,
      "pg_drop_slot": false,
      "pg_logical_plugin": "my_plugin",
      "pg_logical_slot_name": "my_slot",
      "source_conn": "postgres://postgres:postgres@localhost:5432/molt?sslmode=disable",
      "store": "Local",
      "target_conn": "postgres://root@localhost:26257/defaultdb?sslmode=disable",
      "truncate": true
   }'` + "\n" +
		""
}

// ParseEndpoint returns the endpoint and payload as specified on the command
// line.
func ParseEndpoint(
	scheme, host string,
	doer goahttp.Doer,
	enc func(*http.Request) goahttp.Encoder,
	dec func(*http.Response) goahttp.Decoder,
	restore bool,
) (goa.Endpoint, any, error) {
	var (
		moltserviceFlags = flag.NewFlagSet("moltservice", flag.ContinueOnError)

		moltserviceCreateFetchTaskFlags    = flag.NewFlagSet("create-fetch-task", flag.ExitOnError)
		moltserviceCreateFetchTaskBodyFlag = moltserviceCreateFetchTaskFlags.String("body", "REQUIRED", "")
	)
	moltserviceFlags.Usage = moltserviceUsage
	moltserviceCreateFetchTaskFlags.Usage = moltserviceCreateFetchTaskUsage

	if err := flag.CommandLine.Parse(os.Args[1:]); err != nil {
		return nil, nil, err
	}

	if flag.NArg() < 2 { // two non flag args are required: SERVICE and ENDPOINT (aka COMMAND)
		return nil, nil, fmt.Errorf("not enough arguments")
	}

	var (
		svcn string
		svcf *flag.FlagSet
	)
	{
		svcn = flag.Arg(0)
		switch svcn {
		case "moltservice":
			svcf = moltserviceFlags
		default:
			return nil, nil, fmt.Errorf("unknown service %q", svcn)
		}
	}
	if err := svcf.Parse(flag.Args()[1:]); err != nil {
		return nil, nil, err
	}

	var (
		epn string
		epf *flag.FlagSet
	)
	{
		epn = svcf.Arg(0)
		switch svcn {
		case "moltservice":
			switch epn {
			case "create-fetch-task":
				epf = moltserviceCreateFetchTaskFlags

			}

		}
	}
	if epf == nil {
		return nil, nil, fmt.Errorf("unknown %q endpoint %q", svcn, epn)
	}

	// Parse endpoint flags if any
	if svcf.NArg() > 1 {
		if err := epf.Parse(svcf.Args()[1:]); err != nil {
			return nil, nil, err
		}
	}

	var (
		data     any
		endpoint goa.Endpoint
		err      error
	)
	{
		switch svcn {
		case "moltservice":
			c := moltservicec.NewClient(scheme, host, doer, enc, dec, restore)
			switch epn {
			case "create-fetch-task":
				endpoint = c.CreateFetchTask()
				data, err = moltservicec.BuildCreateFetchTaskPayload(*moltserviceCreateFetchTaskBodyFlag)
			}
		}
	}
	if err != nil {
		return nil, nil, err
	}

	return endpoint, data, nil
}

// moltserviceUsage displays the usage of the moltservice command and its
// subcommands.
func moltserviceUsage() {
	fmt.Fprintf(os.Stderr, `MOLT service performs operations using MOLT tooling
Usage:
    %[1]s [globalflags] moltservice COMMAND [flags]

COMMAND:
    create-fetch-task: CreateFetchTask implements create_fetch_task.

Additional help:
    %[1]s moltservice COMMAND --help
`, os.Args[0])
}
func moltserviceCreateFetchTaskUsage() {
	fmt.Fprintf(os.Stderr, `%[1]s [flags] moltservice create-fetch-task -body JSON

CreateFetchTask implements create_fetch_task.
    -body JSON: 

Example:
    %[1]s moltservice create-fetch-task --body '{
      "bucket_name": "http://localhost:5000",
      "bucket_path": "fetch/export",
      "cleanup_intermediary_store": true,
      "compression": "none",
      "local_path": "/usr/Documents/fetch",
      "local_path_crdb_address": "http://localhost:5000",
      "local_path_listen_address": "http://localhost:5000",
      "log_file": "task.log",
      "mode": "DIRECT_COPY",
      "name": "rluu pg to cockroach",
      "num_batch_rows_export": 100000,
      "num_concurrent_tables": 4,
      "num_flush_bytes": 2000,
      "num_flush_rows": 200000,
      "pg_drop_slot": false,
      "pg_logical_plugin": "my_plugin",
      "pg_logical_slot_name": "my_slot",
      "source_conn": "postgres://postgres:postgres@localhost:5432/molt?sslmode=disable",
      "store": "Local",
      "target_conn": "postgres://root@localhost:26257/defaultdb?sslmode=disable",
      "truncate": true
   }'
`, os.Args[0])
}
