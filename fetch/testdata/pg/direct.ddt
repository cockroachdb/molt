exec all
CREATE TABLE tbl1(id INT PRIMARY KEY, t TEXT)
----
[source] CREATE TABLE
[target] CREATE TABLE

exec source
INSERT INTO tbl1 VALUES (1, 'aaa'), (2, 'bb b'), (3, 'Ã©Ã©Ã©'), (4, 'ğŸ«¡ğŸ«¡ğŸ«¡'), (5, 'å¨œå¨œ'), (6, 'Ğ›ÑƒĞºĞ°Ñ'), (7, 'ãƒ«ã‚«ã‚¹')
----
[source] INSERT 0 7

exec all
CREATE TABLE tbl2(id INT PRIMARY KEY, t TEXT)
----
[source] CREATE TABLE
[target] CREATE TABLE

exec source
INSERT INTO tbl2 VALUES (11, 'aaa'), (22, 'bb b'), (33, 'Ã©Ã©Ã©'), (44, 'ğŸ«¡ğŸ«¡ğŸ«¡'), (55, 'å¨œå¨œ'), (66, 'Ğ›ÑƒĞºĞ°Ñ'), (77, 'ãƒ«ã‚«ã‚¹')
----
[source] INSERT 0 7

fetch direct
----

query all
SELECT * FROM tbl1
----
[source]:
id	t
1	aaa
2	bb b
3	Ã©Ã©Ã©
4	ğŸ«¡ğŸ«¡ğŸ«¡
5	å¨œå¨œ
6	Ğ›ÑƒĞºĞ°Ñ
7	ãƒ«ã‚«ã‚¹
tag: SELECT 7
[target]:
id	t
1	aaa
2	bb b
3	Ã©Ã©Ã©
4	ğŸ«¡ğŸ«¡ğŸ«¡
5	å¨œå¨œ
6	Ğ›ÑƒĞºĞ°Ñ
7	ãƒ«ã‚«ã‚¹
tag: SELECT 7

# To test the default "truncate" option is effective.
fetch direct
----

query all
SELECT * FROM tbl1
----
[source]:
id	t
1	aaa
2	bb b
3	Ã©Ã©Ã©
4	ğŸ«¡ğŸ«¡ğŸ«¡
5	å¨œå¨œ
6	Ğ›ÑƒĞºĞ°Ñ
7	ãƒ«ã‚«ã‚¹
tag: SELECT 7
[target]:
id	t
1	aaa
2	bb b
3	Ã©Ã©Ã©
4	ğŸ«¡ğŸ«¡ğŸ«¡
5	å¨œå¨œ
6	Ğ›ÑƒĞºĞ°Ñ
7	ãƒ«ã‚«ã‚¹
tag: SELECT 7

# To test that we can handle multiple batches without hanging.
fetch direct flush-rows=1
----

query all
SELECT * FROM tbl1
----
[source]:
id	t
1	aaa
2	bb b
3	Ã©Ã©Ã©
4	ğŸ«¡ğŸ«¡ğŸ«¡
5	å¨œå¨œ
6	Ğ›ÑƒĞºĞ°Ñ
7	ãƒ«ã‚«ã‚¹
tag: SELECT 7
[target]:
id	t
1	aaa
2	bb b
3	Ã©Ã©Ã©
4	ğŸ«¡ğŸ«¡ğŸ«¡
5	å¨œå¨œ
6	Ğ›ÑƒĞºĞ°Ñ
7	ãƒ«ã‚«ã‚¹
tag: SELECT 7
